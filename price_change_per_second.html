<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<form action="#" method="get" onsubmit="return update_tracker()">
	<div>
		<label for="pol">Check price every x seconds</label>
		<input type="number" name="per"  id="pol" min='5'  placeholder="Default 30s" value='30' required="">
	</div>
	<div>
		<label for="min">Hide coin below x percent change</label>
		<input type="number" name="hide" id="min" min='0.2' step="0.01" placeholder="Default .3%" value='.3' required="">
	</div> 
	<div>
		<label for="min_price">Min price (in sats)</label>
		<input type="number" name="price" id="min_price" min='1' placeholder="Default 100sat" value='100' required="">
	</div> 
	<div>
		<div id="countdown-1">00</div>
		<button type="submit">Apply</button>
	</div>
</form>
<div class='table' id="table-1"></div>
<div class="version">V0.39</div>
<style>
body{
	font-family:tahoma;
	font-size:15px;
    color: #e2e2e2;
    position: relative;
    background-color: #262e33;
}
form{
	max-width: 700px;
	margin: auto;
	text-align: center;
	padding:20px 0px 10px 0px;
	border-bottom: 1px solid #8ad09c;

}
form>div{
display: flex;
flex-direction: row;
justify-content: space-between;
padding-bottom: 10px;
}
label{
	color: #8c8c8c;
	cursor: pointer;
}
input{
	height: 30px;
	padding: 0 10px;
	background:#262e33 !important;
	border: 1px solid orange;
	outline: none;
	color: orange;
	border-radius: 3px;
	transition: all 200ms ease;
}
input:focus{
	box-shadow: 0 0 3px orange;
	}
button{
	width: 100px;
	outline: none;
	height: 30px;
	color: orange;
	background:#262e33 !important;
	border: 1px solid orange;
	border-radius: 3px;
}
#countdown-1{
    text-align: center;
    font-size: 20px;
    color: #70d6dc;
    padding: 3px;
    min-width: 30px;
    border: 1px solid;
}
.table{
	text-align: center;
	max-width: 700px;
	margin: auto;
}
.table>a{
    display: flex;
    text-decoration: none;
    justify-content: space-around;
    border-bottom: 1px solid #3e401a;
    padding: 5px 0px;
    color: orange;
}
.table a>div{
	width: calc(100% / 5);
	text-align: left;
}
.table>a:hover{
	background: #222;
}
.prev{
	margin-left:10px;
	font-size: 10px;
	padding: 3px 5px;
	border:1px solid;
	border-radius: 3px;
	display: inline-block;
	min-width: 40px;
}
.table a, .table span.prev{
	color: rgb(112, 168, 0);
}

.table a[data-change^="-"], .table span.prev[data-change^="-"]{
	color:rgb(234, 0, 112);
}
.version{
	position: absolute;
	bottom:0;
	right: 0;
	color: slategray;
}
</style>
<script>

var instruments=[];

var pol = 30;

var count = pol;

var hide_below = .3;

var min_price = 100;

var timer = 0;

function load_instruments(dat){

				dat.forEach(function(item){
						if(item.symbol.indexOf("BTC")>0){
							item.prev=0;
							instruments.push(item);
						}
					});
}

function tick(){
	$("#countdown-1").html(count);
	if(count==0){
		count=pol;
		updater();
	}
	count--;
}

function updater(){ 

				$.getJSON({
						url:"https://api.binance.com/api/v1/ticker/24hr",
						success:function(dt){
									dt.forEach(function(dt){
										the = dt.symbol;
										id = instruments.findIndex(function(e){
											if(e.symbol==the)
												return true;
											else 
												return false;
										});
										if(id>-1){
											ins = instruments[id];
											instruments[id].change = Number.parseFloat(100*((dt.lastPrice-ins.lastPrice)/ins.lastPrice)).toFixed(2);
											instruments[id].lastPrice=dt.lastPrice;
										}
									});
									update_view();
									instruments.forEach(function(t){
										t.prev=t.change;
									});
						}
					});
}

function update_view(){

	$(".table").html("");

	show=[];

	instruments.forEach(function(t){
		if(Math.abs(t.change)>hide_below && t.lastPrice>(.00000001*min_price)){
			show.push(t); 
		} 
	});

	show.sort(function(a,b){
			if(a.change<b.change)	
				return 1;
			else if(a.change>b.change)
				return -1;
			else
				return 0;
		});

	show.forEach(function(t){

		row="<a data-change='"+t.change+"' target='_blank' href='https://www.binance.com/en/trade/pro/"+t.symbol.replace("BTC","_BTC")+"'>\
				<div>"+t.symbol+"</div>\
				<div>"+t.lastPrice+"</div>\
				<div>"+t.priceChangePercent+"</div>\
				<div>"+t.volume+"</div>\
				<div>"+t.change+"<span class='prev' data-change='"+t.prev+"'>"+t.prev+"</span></div>\
			</a>";

		$("#table-1").append(row);
	});
}

function update_tracker(){
	pol = count = Number($("#pol").val());
	hide_below = Number($("#min").val());
	min_price = Number($("#min_price").val());
	return false;
}

function init(){
	$.getJSON({url:"https://api.binance.com/api/v1/ticker/24hr",
			success:load_instruments
			});
}
 
init();

timer = setInterval(tick,1000);

</script>
